<%- include('../includes/header.ejs', { titulo: 'Lista de Categorias' }) %>

<main class="p-4 md:p-6 pb-24 bg-neutra-50 min-h-screen">
  <% if (typeof mensagem !== 'undefined' && mensagem) { %>
    <p class="text-red-600 mb-4"><%= mensagem %></p>
  <% } %>

  <div class="max-w-3xl mx-auto mb-8">
    <div class="relative">
      <input 
        type="text" 
        id="busca-categoria" 
        placeholder="Buscar categoria..." 
        value="<%= typeof busca !== 'undefined' ? busca : '' %>"
        class="w-full pl-12 pr-6 py-4 text-base md:text-lg bg-white border border-gray-300 rounded-xl shadow-sm 
               focus:outline-none focus:ring-2 focus:ring-sistema-500 focus:border-transparent 
               transition-all duration-300 placeholder-gray-400"
        onkeyup="filtrarCategorias()">
      <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
        <svg class="w-6 h-6 text-sistema-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
      </div>
    </div>
  </div>

  <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3" id="lista-categorias">
    <% if (categorias && categorias.length > 0) { %>
      <% categorias.forEach(d => { %>
        <div
          class="categoria-item bg-white rounded-lg shadow-md p-4 flex flex-col justify-between border border-gray-200
                 hover:shadow-xl hover:-translate-y-1 hover:bg-sistema-50 transition-all duration-300 ease-in-out"
          title="Clique nos botões para editar ou deletar esta categoria"
          data-nome="<%= d.nome_categoria.toLowerCase() %>">

          <div>
            <p class="font-semibold text-sistema-700 text-base md:text-lg mb-1">
              <%= d.nome_categoria %>
            </p>
            <p class="text-gray-600 text-sm">
              Descrição: <span class="text-gray-800"><%= d.descricao || '—' %></span>
            </p>
          </div>

          <div class="flex justify-end gap-3 mt-3">
            <form action="/categorias/<%= d.id_categoria %>/editar" method="GET">
              <button type="submit"
                      title="Editar categoria"
                      class="bg-green-600 hover:bg-sucesso-700 p-2 rounded-full shadow flex items-center justify-center transition-transform hover:scale-110">
                <img src="/img/edit.svg" alt="Editar" class="w-4 h-4 md:w-5 md:h-5">
              </button>
            </form>

            <form action="/categorias/<%= d.id_categoria %>/deletar" method="POST"
                  onsubmit="return confirm('Deseja realmente excluir esta Categoria?')">
              <button type="submit"
                      title="Excluir categoria"
                      class="bg-red-600 hover:bg-erro-700 p-2 rounded-full shadow flex items-center justify-center transition-transform hover:scale-110">
                <img src="/img/delete.svg" alt="Deletar" class="w-4 h-4 md:w-5 md:h-5">
              </button>
            </form>
          </div>
        </div>
      <% }) %>
    <% } else { %>
      <div class="col-span-full mt-6 p-6 border border-dashed border-gray-300 rounded-2xl text-center text-gray-600">
        Nenhuma Categoria cadastrada.
      </div>
    <% } %>
  </div>

  <!-- PAGINAÇÃO PEQUENA, BONITA E VISÍVEL (igual às outras telas) -->
  <% if (paginacao && paginacao.totalPaginas >= 1) { %>
    <div class="flex justify-center mt-10">
      <div class="inline-flex items-center gap-3 bg-white px-6 py-3 rounded-full shadow-lg border border-gray-300">
        <!-- Anterior -->
        <% if (paginacao.paginaAtual > 1) { %>
          <a href="?pagina=<%= paginacao.paginaAtual - 1 %><%= busca ? '&busca=' + busca : '' %>"
             class="w-10 h-10 flex items-center justify-center rounded-full bg-sistema-100 text-sistema-700 font-bold hover:bg-sistema-200 transition">
            ←
          </a>
        <% } else { %>
          <span class="w-10 h-10 flex items-center justify-center rounded-full text-gray-400">←</span>
        <% } %>

        <!-- Página atual / total -->
        <span class="text-lg font-bold text-gray-800">
          <%= paginacao.paginaAtual %> <span class="text-gray-500">de</span> <%= paginacao.totalPaginas %>
        </span>

        <!-- Próximo -->
        <% if (paginacao.paginaAtual < paginacao.totalPaginas) { %>
          <a href="?pagina=<%= paginacao.paginaAtual + 1 %><%= busca ? '&busca=' + busca : '' %>"
             class="w-10 h-10 flex items-center justify-center rounded-full bg-sistema-100 text-sistema-700 font-bold hover:bg-sistema-200 transition">
            →
          </a>
        <% } else { %>
          <span class="w-10 h-10 flex items-center justify-center rounded-full text-gray-400">→</span>
        <% } %>
      </div>
    </div>
  <% } %>

  <a href="/categorias/novo"
     aria-label="Adicionar Categoria"
     title="Adicionar nova Categoria"
     class="bg-green-500 text-white fixed right-6 bottom-24 md:bottom-8 z-50
            w-14 h-14 rounded-full bg-gradient-to-b from-sistema-500 to-sistema-700
            flex items-center justify-center shadow-lg
            hover:shadow-xl hover:scale-110 transition-all duration-300
            focus:outline-none focus:ring-4 focus:ring-white/50">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" viewBox="0 0 24 24" fill="currentColor">
      <path d="M11 5a1 1 0 1 1 2 0v6h6a1 1 0 1 1 0 2h-6v6a1 1 0 1 1-2 0v-6H5a1 1 0 1 1 0-2h6V5z"/>
    </svg>
  </a>
</main>

<script>
  function filtrarCategorias() {
    const input = document.getElementById('busca-categoria');
    const filtro = input.value.toLowerCase().trim();
    const itens = document.querySelectorAll('.categoria-item');

    itens.forEach(item => {
      const nome = item.getAttribute('data-nome');
      item.style.display = nome.includes(filtro) ? '' : 'none';
    });
  }
</script>

<%- include('../includes/footer.ejs') %>